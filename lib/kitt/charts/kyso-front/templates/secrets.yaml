{{- define "kyso-front.env" -}}
DATABASE_URI={{ printf "%s?retryWrites=true&w=majority" .Values.kysoApiEnv.mongodbDatabaseUri }}
PORT={{ .Values.service.targetPort }}
APP_MOUNT_DIR=/api
{{- if .Values.kysoApiEnv.populateTestData }}
POPULATE_TEST_DATA={{ printf "%t" .Values.kysoApiEnv.populateTestData }}
{{- end }}
{{- if .Values.kysoApiEnv.populateMailPrefix }}
POPULATE_TEST_DATA_MAIL_PREFIX={{ .Values.kysoApiEnv.populateMailPrefix }}
{{- end }}
{{- end -}}
{{- if and .Values.kysoApiEnv .Values.kysoApiEnv.mongodbDatabaseUri }}
{{- $secretsName := printf "%s-secrets" (include "kyso-front.fullname" . | trunc 59) }}
apiVersion: v1
kind: Secret
metadata:
  name: "{{ $secretsName }}"
type: Opaque
data:
  env: |
    {{ include "kyso-front.env" . | b64enc }}
{{- else }}
{{- fail "Define kysoApiEnv.mongodbDatabaseUri to deploy the chart" }}
{{- end }}
